<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ—Å–∫–∞ –ø—Ä–æ–ø–∏—Å–µ–π | Propisi.site</title>
    
    <link rel="icon" type="image/png" href="favicon.png">

    <script type="text/javascript" >
       (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
       m[i].l=1*new Date();
       for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
       k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
       (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
       ym(106467293, "init", {clickmap:true, trackLinks:true, accurateTrackBounce:true, webvisor:true});
    </script>

    <style>
        @font-face { font-family: 'PrimoFont'; src: url('primo.ttf'); }
        :root { 
            --ink: #007AFF; 
            --paper: #FFFFFF;
            --text: #1D1D1F;
            --sidebar-bg: #FFFFFF;
            --accent: #007AFF;
            --header-h: 60px;
            --footer-h: 50px;
        }

        * { box-sizing: border-box; touch-action: none; }
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background-color: #F2F2F7; 
            height: 100vh; 
            display: flex; 
            flex-direction: column;
            overflow: hidden; 
        }

        /* 1. –£–ù–ò–§–ò–¶–ò–†–û–í–ê–ù–ù–ê–Ø –®–ê–ü–ö–ê */
        header {
            height: var(--header-h);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
            border-bottom: 1px solid rgba(0,0,0,0.06);
            flex-shrink: 0;
            display: flex; align-items: center;
            z-index: 1100;
        }
        .header-container { 
            width: 100%; max-width: 1000px; margin: 0 auto; padding: 0 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .logo {
            font-family: 'PrimoFont', cursive;
            font-size: 28px; color: var(--ink);
            text-decoration: none; 
            text-shadow: 0 1px 0 #fff;
            white-space: nowrap;
        }
        .top-menu { display: flex; gap: 15px; }
        .top-menu a {
            text-decoration: none; color: #333; font-weight: 500; font-size: 14px;
            transition: 0.2s; padding: 5px 8px; border-radius: 6px;
        }
        .top-menu a:hover { color: var(--ink); background: rgba(0,122,255,0.05); }

        /* 2. –†–ê–ë–û–ß–ê–Ø –û–ë–õ–ê–°–¢–¨ */
        .app-body { display: flex; flex: 1; overflow: hidden; position: relative; }

        /* –ì–ê–ú–ë–£–†–ì–ï–† - –ó–∞–∫—Ä–µ–ø–ª–µ–Ω –Ω–∞ –ø–∞–Ω–µ–ª–∏ */
        .toggle-btn { 
            position: absolute; top: 10px; right: -54px;
            width: 44px; height: 44px; background: white; border-radius: 10px;
            box-shadow: 4px 0 10px rgba(0,0,0,0.05);
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; border: 1px solid #eee; cursor: pointer;
            z-index: 2000; color: var(--accent);
        }

        .sidebar { 
            width: 320px; min-width: 320px; height: 100%; 
            background: var(--sidebar-bg); border-right: 1px solid rgba(0,0,0,0.1);
            display: flex; flex-direction: column; padding: 20px; padding-top: 60px;
            gap: 20px; overflow-y: auto; z-index: 1000; transition: transform 0.3s;
            position: relative;
        }
        .sidebar.closed { transform: translateX(-100%); }

        .main-canvas-area { 
            flex-grow: 1; position: relative; overflow: hidden;
            /* –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ–Ω —Å–∞–π—Ç–∞ */
            background-image: url("data:image/svg+xml,%3Csvg width='40' height='120' viewBox='0 0 40 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='grid' x='0' y='0' width='40' height='120' patternUnits='userSpaceOnUse'%3E%3Cpath d='M0,120 L40,0' stroke='%23D9D9D9' stroke-width='1' fill='none'/%3E%3Cline x1='0' y1='30' x2='40' y2='30' stroke='%238CA6D6' stroke-width='1'/%3E%3Cline x1='0' y1='60' x2='40' y2='60' stroke='%238CA6D6' stroke-width='1'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23grid)'/%3E%3C/svg%3E");
            background-size: 40px 120px;
        }

        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #gridCanvas { pointer-events: none; }

        /* –ò–ù–°–¢–†–£–ú–ï–ù–¢–´ */
        .tool-group { display: flex; flex-direction: column; gap: 8px; }
        .label { font-size: 11px; font-weight: 700; text-transform: uppercase; color: #8E8E93; letter-spacing: 0.5px; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        
        button.tool-btn { 
            padding: 10px; border-radius: 10px; border: 1px solid #E5E5EA; 
            background: white; cursor: pointer; font-size: 13px; font-weight: 500;
            transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 5px;
        }
        button.tool-btn:hover { background: #F2F2F7; }
        button.active { background: var(--accent) !important; color: white !important; border-color: var(--accent); }

        .color-picker { display: flex; gap: 8px; }
        .color-dot { width: 32px; height: 32px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
        .color-dot.active { border-color: #000; transform: scale(1.1); }

        .recording-box { 
            margin-top: auto; padding: 15px; background: #FFF5F5; border-radius: 12px; 
            border: 1px solid #FFDADA; text-align: center; 
        }
        #recBtn { background: #FF3B30; color: white; border: none; width: 100%; padding: 12px; border-radius: 10px; font-weight: 600; cursor: pointer; }
        #recBtn.recording { animation: blink 1s infinite; background: #000; }
        @keyframes blink { 50% { opacity: 0.6; } }

        /* 3. –§–£–¢–ï–† */
        footer {
            height: var(--footer-h); flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; color: #888;
            background: rgba(255,255,255,0.95);
            border-top: 1px solid rgba(0,0,0,0.05);
            z-index: 1100;
        }

        @media (max-width: 900px) {
            .sidebar { position: fixed; left: 0; top: 60px; bottom: 50px; }
            .top-menu { display: none; }
            .header-container { justify-content: center; }
            .toggle-btn { right: 10px; top: 10px; border-radius: 50%; }
        }
    </style>
</head>
<body>

    <header>
        <div class="header-container">
            <a href="index.html" class="logo" id="logoLink">–°–∞–π—Ç –ø—Ä–æ–ø–∏—Å–µ–π</a>
            <nav class="top-menu">
                <a href="board.html" style="color:var(--ink);">–î–æ—Å–∫–∞</a>
                <a href="generator.html">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</a>
                <a href="propisi-alfavit.html">–ê–ª—Ñ–∞–≤–∏—Ç</a>
                <a href="about.html">–û –Ω–∞—Å</a>
            </nav>
        </div>
    </header>

    <div class="app-body">
        <div class="sidebar" id="appSidebar">
            <button class="toggle-btn" onclick="toggleSidebar()">‚ò∞</button>
            
            <div class="tool-group">
                <div class="label">1. –°–µ—Ç–∫–∞ —Ñ–æ–Ω–∞</div>
                <div class="btn-grid">
                    <button class="tool-btn active" onclick="setGrid('often')">–ö–æ—Å–∞—è</button>
                    <button class="tool-btn" onclick="setGrid('mazina')">–ú–∞–∑–∏–Ω–æ–π</button>
                    <button class="tool-btn" onclick="setGrid('cell')">–ö–ª–µ—Ç–∫–∞</button>
                    <button class="tool-btn" onclick="setGrid('none')">–ß–∏—Å—Ç–∞—è</button>
                </div>
                <button class="tool-btn" onclick="document.getElementById('fileInput').click()" style="width:100%; margin-top:5px;">üñº –°–≤–æ—ë —Ñ–æ—Ç–æ</button>
                <input type="file" id="fileInput" hidden accept="image/*" onchange="handleFile(event)">
            </div>

            <div class="tool-group">
                <div class="label">2. –¶–≤–µ—Ç –ø–µ—Ä–∞</div>
                <div class="color-picker">
                    <div class="color-dot active" style="background: #007AFF;" onclick="setColor('#007AFF', this)"></div>
                    <div class="color-dot" style="background: #000000;" onclick="setColor('#000000', this)"></div>
                    <div class="color-dot" style="background: #FF3B30;" onclick="setColor('#FF3B30', this)"></div>
                    <div class="color-dot" style="background: #4CD964;" onclick="setColor('#4CD964', this)"></div>
                </div>
            </div>

            <div class="tool-group">
                <div class="label">3. –î–µ–π—Å—Ç–≤–∏—è</div>
                <button class="tool-btn" onclick="clearCanvas()" style="width:100%; color:#FF3B30;">üóë –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
            </div>

            <div class="recording-box">
                <div class="label" style="color:#FF3B30; margin-bottom:10px;">–ó–∞–ø–∏—Å—å —É—Ä–æ–∫–∞</div>
                <button id="recBtn" onclick="toggleRecording()">üìπ –ó–∞–ø–∏—Å–∞—Ç—å –≤–∏–¥–µ–æ</button>
                <p style="font-size:10px; color:#999; margin-top:8px;">–í–∏–¥–µ–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.</p>
            </div>
        </div>

        <div class="main-canvas-area">
            <canvas id="gridCanvas"></canvas>
            <canvas id="drawCanvas"></canvas>
        </div>
    </div>

    <footer>
        <p>–°–∞–π—Ç –ø—Ä–æ–ø–∏—Å–µ–π (propisi.site) ‚Äî —Å–¥–µ–ª–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –∫ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—é ¬© 2026.</p>
    </footer>

    <script>
        const dCanvas = document.getElementById('drawCanvas');
        const dCtx = dCanvas.getContext('2d');
        const gCanvas = document.getElementById('gridCanvas');
        const gCtx = gCanvas.getContext('2d');
        const sidebar = document.getElementById('appSidebar');

        let isDrawing = false;
        let currentColor = '#007AFF';
        let currentGrid = 'often';
        let bgImg = null;

        // –í–∏–¥–µ–æ–∑–∞–ø–∏—Å—å
        let mediaRecorder;
        let recordedChunks = [];

        function toggleSidebar() { sidebar.classList.toggle('closed'); }

        window.onload = () => {
            // –õ–æ–≥–æ—Ç–∏–ø —Å–æ —Å–≤—è–∑–∫–∞–º–∏
            document.getElementById('logoLink').innerText = processPrimoText("–°–∞–π—Ç –ø—Ä–æ–ø–∏—Å–µ–π");
            resize();
            setGrid('often');
        };

        window.onresize = resize;

        function resize() {
            const rect = dCanvas.parentElement.getBoundingClientRect();
            dCanvas.width = gCanvas.width = rect.width;
            dCanvas.height = gCanvas.height = rect.height;
            drawGrid();
        }

        // –†–ò–°–û–í–ê–ù–ò–ï
        function startDrawing(e) {
            isDrawing = true;
            dCtx.beginPath();
            const pos = getPos(e);
            dCtx.moveTo(pos.x, pos.y);
        }

        function draw(e) {
            if (!isDrawing) return;
            const pos = getPos(e);
            dCtx.lineTo(pos.x, pos.y);
            dCtx.strokeStyle = currentColor;
            dCtx.lineWidth = 3;
            dCtx.lineCap = 'round';
            dCtx.lineJoin = 'round';
            dCtx.stroke();
        }

        function stopDrawing() { isDrawing = false; }

        function getPos(e) {
            const rect = dCanvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: clientX - rect.left, y: clientY - rect.top };
        }

        dCanvas.addEventListener('mousedown', startDrawing);
        dCanvas.addEventListener('mousemove', draw);
        dCanvas.addEventListener('mouseup', stopDrawing);
        dCanvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDrawing(e); });
        dCanvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); });
        dCanvas.addEventListener('touchend', stopDrawing);

        // –°–ï–¢–ö–ò
        function setGrid(type) {
            currentGrid = type;
            bgImg = null;
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
            event?.target.classList.add('active');
            drawGrid();
        }

        function drawGrid() {
            gCtx.clearRect(0, 0, gCanvas.width, gCanvas.height);
            if (bgImg) {
                const ratio = Math.min(gCanvas.width / bgImg.width, gCanvas.height / bgImg.height);
                gCtx.drawImage(bgImg, 0, 0, bgImg.width * ratio, bgImg.height * ratio);
                return;
            }
            if (currentGrid === 'none') return;

            const w = gCanvas.width; const h = gCanvas.height;
            gCtx.strokeStyle = '#D1D1D6'; gCtx.lineWidth = 1;

            if (currentGrid === 'cell') {
                for(let x=0; x<w; x+=30) { gCtx.beginPath(); gCtx.moveTo(x,0); gCtx.lineTo(x,h); gCtx.stroke(); }
                for(let y=0; y<h; y+=30) { gCtx.beginPath(); gCtx.moveTo(0,y); gCtx.lineTo(w,y); gCtx.stroke(); }
            } else {
                let y = 50;
                while (y < h) {
                    gCtx.strokeStyle = '#8CA6D6'; gCtx.setLineDash([]);
                    gCtx.beginPath(); gCtx.moveTo(0, y); gCtx.lineTo(w, y); gCtx.stroke();
                    gCtx.beginPath(); gCtx.moveTo(0, y + 40); gCtx.lineTo(w, y + 40); gCtx.stroke();
                    if (currentGrid === 'mazina') {
                        gCtx.setLineDash([5, 5]); gCtx.beginPath(); 
                        gCtx.moveTo(0, y + 20); gCtx.lineTo(w, y + 20); gCtx.stroke();
                    }
                    y += 120;
                }
                gCtx.setLineDash([]); gCtx.strokeStyle = '#E5E5EA';
                for (let x = -h*0.4; x < w; x += (currentGrid === 'mazina' ? 40 : 150)) {
                    gCtx.beginPath(); gCtx.moveTo(x + h*0.4, 0); gCtx.lineTo(x, h); gCtx.stroke();
                }
            }
        }

        function handleFile(e) {
            const reader = new FileReader();
            reader.onload = (event) => {
                bgImg = new Image();
                bgImg.onload = drawGrid;
                bgImg.src = event.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        }

        function setColor(c, el) {
            currentColor = c;
            document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
            el.classList.add('active');
        }

        function clearCanvas() { dCtx.clearRect(0, 0, dCanvas.width, dCanvas.height); }

        // –ó–ê–ü–ò–°–¨
        async function toggleRecording() {
            const btn = document.getElementById('recBtn');
            if (mediaRecorder && mediaRecorder.state === "recording") {
                mediaRecorder.stop();
                btn.innerText = "üìπ –ó–∞–ø–∏—Å–∞—Ç—å –≤–∏–¥–µ–æ";
                btn.classList.remove('recording');
            } else {
                recordedChunks = [];
                const stream = dCanvas.captureStream(30);
                mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
                mediaRecorder.ondataavailable = e => recordedChunks.push(e.data);
                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url; a.download = 'lesson.webm'; a.click();
                };
                mediaRecorder.start();
                btn.innerText = "üõë –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å";
                btn.classList.add('recording');
            }
        }

        // –î–í–ò–ñ–û–ö PRIMO
        function getHeadAndTail(char){const code=char.charCodeAt(0);const map={0x0410:{h:100,t:8},0x0411:{h:100,t:100},0x0412:{h:100,t:100},0x0413:{h:100,t:100},0x0414:{h:100,t:8},0x0415:{h:100,t:4},0x0416:{h:100,t:4},0x0417:{h:100,t:100},0x0418:{h:100,t:1},0x0419:{h:100,t:1},0x041A:{h:100,t:1},0x041B:{h:100,t:1},0x041C:{h:100,t:1},0x041D:{h:100,t:1},0x041E:{h:100,t:100},0x041F:{h:100,t:1},0x0420:{h:100,t:100},0x0421:{h:100,t:4},0x0422:{h:100,t:1},0x0423:{h:100,t:100},0x0424:{h:100,t:100},0x0425:{h:100,t:4},0x0426:{h:100,t:6},0x0427:{h:100,t:1},0x0428:{h:100,t:1},0x0429:{h:100,t:6},0x042A:{h:100,t:100},0x042B:{h:100,t:1},0x042C:{h:100,t:100},0x042D:{h:100,t:100},0x042E:{h:100,t:100},0x042F:{h:100,t:1},0x0401:{h:100,t:4},0x0430:{h:2,t:1},0x0431:{h:2,t:100},0x0432:{h:6,t:2},0x0433:{h:7,t:1},0x0434:{h:2,t:3},0x0435:{h:5,t:4},0x0436:{h:4,t:4},0x0437:{h:4,t:3},0x0438:{h:1,t:1},0x0439:{h:1,t:1},0x043A:{h:1,t:1},0x043B:{h:3,t:1},0x043C:{h:3,t:1},0x043D:{h:1,t:1},0x043E:{h:2,t:5},0x043F:{h:1,t:1},0x0440:{h:1,t:1},0x0441:{h:2,t:4},0x0442:{h:1,t:1},0x0443:{h:1,t:3},0x0444:{h:2,t:100},0x0445:{h:4,t:4},0x0446:{h:1,t:6},0x0447:{h:8,t:1},0x0448:{h:1,t:1},0x0449:{h:1,t:6},0x044A:{h:8,t:7},0x044B:{h:1,t:1},0x044C:{h:1,t:7},0x044D:{h:4,t:100},0x044E:{h:1,t:5},0x044F:{h:3,t:1},0x0451:{h:5,t:4}};if(map[code])return map[code];if(code>=0xE000)return{h:200,t:200};return{h:0,t:0}}function ins(c1,c2){if(!c1||!c2)return"";const info1=getHeadAndTail(c1);const info2=getHeadAndTail(c2);const t=info1.t,h=info2.h;if(t===0){if(h===1||h===2||h===3||h===100)return"\uE402";if(h===4)return"\uE402\uE007";if(h===5)return"\uE402\uE005";if(h===6)return"\uE402\uE006";if(h===7)return"\uE402\uE007";if(h===8)return"\uE402\uE008"}if(t===100){if(h===1)return"\uE402\uE402";if(h===2)return"\uE402\uE401";if(h===100)return"\uE403"}return""}function processPrimoText(text){if(!text)return"";let res="";let c1="";let c2=text[0];res+=ins(" ",c2)+c2;for(let i=1;i<text.length;i++){c1=c2;c2=text[i];res+=ins(c1,c2)+c2}res+=ins(c2," ");return res}
    </script>
</body>
</html>
